{% extends "dashboard.html" %}

{% block title %}Empleados{% endblock %}
{% block container_class %}justify-content-start align-items-start{% endblock %}

{% block content %}
<h3 class="mb-3 d-flex justify-content-center align-items-center fw-bold">Gestión de Empleados</h3>

<!-- Tabla -->
<div class="card shadow-sm border-0 rounded-3">
    <div class="card-body p-3">
        <div class="table-responsive-md">
            <table class="table  table-striped table-hover table-borderless align-middle text-center w-100 fs-6" id="tabla-empleados">
                <thead class="table-dark border-bottom border-2 fw-semibold">
                    <tr>
                        <th scope="col" class="py-3">#</th>
                        <th scope="col" class="py-3">NOMBRE COMPLETO</th>
                        <th scope="col" class="py-3">DOCUMENTO</th>
                        <th scope="col" class="py-3">CARGO</th>
                        <th scope="col" class="py-3">CORREO INSTITUCIONAL</th>
                        <th scope="col" class="py-3">ESTADO</th>
                        <th scope="col" class="py-3"></th>
                    </tr>
                </thead>
                <!-- El body lo llena DataTables -->
            </table>
        </div>
    </div>
</div>


<!-- Script DataTable -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        $('#tabla-empleados').DataTable({
            processing: true,
            serverSide: false,
            responsive: true,
            ajax: {
                url: "/api/empleados/",
                dataSrc: ""
            },
            columns: [
                { data: null, render: (d,t,r,m) => m.row + 1 },
                { data: "nombre_completo", render: (data) => data ? data.toUpperCase() : "-" },
                {
                    data: "documento",
                    render: function (data, type, row) {
                        if (!data) return "-";
                        let sides = data.split(" - ");
                        let typeSide = sides[0];
                        let formattedNumberDocument = sides[1];
                        let numberDocument = formattedNumberDocument.replace(/\./g, "");
                        if (type === 'filter' || type === 'sort') {
                            return `${typeSide} - ${numberDocument}`;
                        }
                        return data;
                    }
                },
                { data: "cargo", render: (data) => data ? data.toUpperCase() : "-" },
                { data: null, render: () => "-" },
                { data: "activo", render: (activo) => `
                    <span class="badge rounded-pill text-${activo ? 'success-emphasis' : 'danger-emphasis'} bg-${activo ? 'success-subtle' : 'danger-subtle'} px-3 py-2">
                        ${activo ? "Activo" : "Inactivo"}
                    </span>
                `},
                { data: null, orderable: false, render: () => `
                    <div class="dropdown">
                        <a class="text-secondary-emphasis" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-calendar-week me-2"></i>Definir Horario</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-qr-code me-2"></i>Generar Código QR</a></li>
                        </ul>
                    </div>
                `}
            ],
            pageLength: 25,
            language: {
                url: "https://cdn.datatables.net/plug-ins/1.13.8/i18n/es-ES.json"
            }
        });
    });
</script>
{% endblock %}
